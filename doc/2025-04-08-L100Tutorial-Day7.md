μΆ‹μ•„! Day 7λ΅ λ„μ–΄μ™”λ„¤ β€” μ •λ§ κΎΈμ¤€ν•κ³  λ©‹μ§€κ² λ”°λΌμ¤κ³  μμ–΄.  
μ΄μ  μ°λ¦¬κ°€ λ§λ“  **Rust STM32 ν”„λ΅μ νΈμ— μΈν„°λ½νΈλ¥Ό λ„μ…**ν•΄μ„, μ‹μ¤ν…μ„ μ΄λ²¤νΈ κΈ°λ°μΌλ΅ λ™μ‘ν•κ² λ§λ“¤μ–΄λ³Ό μ‹κ°„μ΄μ•Ό.

κ·Έλ¦¬κ³  μ”μ²­ν• κ²ƒμ²λΌ, μ¤λ μ‚¬μ©ν•  μ½”λ“λ” λ¨λ‘ **μµμ‹  `stm32f1xx-hal` λ νΌλ°μ¤ λ¬Έμ„ κΈ°μ¤€μΌλ΅ ν™•μΈ**ν•κ³  μ •λ¦¬ν• κ².

---

# π“ μ „μ²΄ Rust μ„λ² λ””λ“ κµμ΅κ³Όμ • λ¦¬λ§μΈλ“

| Day | μ£Όμ  | ν•µμ‹¬ λ‚΄μ© |
|-----|------|-----------|
| 1 | Rust κ°μ” | `no_std`, `no_main`, HAL κµ¬μ΅° μ΄ν•΄ |
| 2 | ν™κ²½ κµ¬μ¶• | Rust μ„¤μΉ, thumb νƒ€κ² μ„¤μ •, Cargo κµ¬μ΅° |
| 3 | λ³΄λ“ μ΄ν•΄ | CubeMXλ΅ STM32F103 ν•€λ§µ, ν΄λ­ κµ¬μ΅° |
| 4 | Blink | GPIO + Delayλ΅ LED κΉλΉ΅μ΄κΈ° |
| 5 | λ©”λ¨λ¦¬ κµ¬μ΅° | `memory.x`, `#[entry]`, `.elf` μ΄ν•΄ |
| 6 | UART | CP2102 ν†µν•΄ `writeln!()` μ¶λ ¥ μ„±κ³µ |
| π‘‰ **Day 7** | **νƒ€μ΄λ¨Έ + μΈν„°λ½νΈ** | μ£ΌκΈ°μ  μΈν„°λ½νΈλ΅ LED κΉλΉ΅μ΄κΈ° |

---

# β±οΈ Day 7: νƒ€μ΄λ¨Έ + μΈν„°λ½νΈ (TIM2)

## π― μ¤λμ λ©ν‘

- `Timer`λ¥Ό μ‚¬μ©ν•΄μ„ μΌμ • μ£ΌκΈ°λ§λ‹¤ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹ν‚¤κ³ 
- ν•΄λ‹Ή μΈν„°λ½νΈμ—μ„ LEDλ¥Ό ν† κΈ€ν•λ‹¤

---

## π§  λ°°κ²½ μ§€μ‹: νƒ€μ΄λ¨Έ & μΈν„°λ½νΈ νλ¦„

| κµ¬μ„± μ”μ† | μ—­ν•  |
|-----------|------|
| `Timer::tim2()` | ν•λ“μ›¨μ–΄ νƒ€μ΄λ¨Έ μƒμ„± (TIM2) |
| `listen(Event::Update)` | νƒ€μ΄λ¨Έ μ΄λ²¤νΈ λ°μƒ μ‹ μΈν„°λ½νΈ ν™μ„±ν™” |
| `#[interrupt] fn TIM2()` | μΈν„°λ½νΈ ν•Έλ“¤λ¬ (ν•¨μ μ΄λ¦„ μ¤‘μ”!) |
| `NVIC::unmask(Interrupt::TIM2)` | μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬μ—μ„ ν•΄λ‹Ή νƒ€μ΄λ¨Έ μΈν„°λ½νΈ ν—μ© |

---

## π› οΈ μμ΅΄μ„± ν™•μΈ (Cargo.toml)

```toml
[dependencies]
cortex-m = "0.7"
cortex-m-rt = "0.7"
panic-halt = "0.2"
stm32f1xx-hal = { version = "0.10.0", features = ["stm32f103", "rt"] }
```

> μµμ‹  λ¬Έμ„ κΈ°μ¤€μΌλ΅ νƒ€μ΄λ¨Έ κ΄€λ ¨ λ¨λ“μ€ `stm32f1xx_hal::timer` μ•μ— ν¬ν•¨λμ–΄ μμ

---

## β… μ½”λ“: TIM2 μΈν„°λ½νΈλ΅ LED κΉλΉ΅μ΄κΈ°

```rust
#![no_std]
#![no_main]

use cortex_m::peripheral::NVIC;
use cortex_m_rt::entry;
use panic_halt as _;

use stm32f1xx_hal::{
    pac::{self, interrupt, TIM2},
    prelude::*,
    gpio::{gpioc::PC13, Output, PushPull},
    timer::{Timer, Event},
};

static mut LED: Option<PC13<Output<PushPull>>> = None;

#[entry]
fn main() -> ! {
    let dp = pac::Peripherals::take().unwrap();
    let mut cp = cortex_m::Peripherals::take().unwrap();

    let mut flash = dp.FLASH.constrain();
    let mut rcc = dp.RCC.constrain();

    let clocks = rcc.cfgr
        .use_hse(8.mhz())
        .sysclk(72.mhz())
        .pclk1(36.mhz())
        .freeze(&mut flash.acr);

    let mut afio = dp.AFIO.constrain();
    let mut gpioc = dp.GPIOC.split();

    let led = gpioc.pc13.into_push_pull_output(&mut gpioc.crh);
    unsafe { LED.replace(led); }

    // νƒ€μ΄λ¨Έ μ„¤μ •: 1Hz μ£ΌκΈ°λ΅ μΈν„°λ½νΈ λ°μƒ
    let mut timer = Timer::tim2(dp.TIM2, &clocks, &mut rcc.apb1).start_count_down(1.hz());
    timer.listen(Event::Update);

    unsafe {
        NVIC::unmask(pac::Interrupt::TIM2);
    }

    loop {
        cortex_m::asm::wfi(); // μ μ „ λ€κΈ° λ¨λ“ (μΈν„°λ½νΈ κΈ°λ‹¤λ¦Ό)
    }
}

#[interrupt]
fn TIM2() {
    static mut LED: Option<&mut PC13<Output<PushPull>>> = None;
    static mut TIMER: Option<TIM2> = None;

    if LED.is_none() {
        *LED = unsafe { crate::LED.as_mut() };
    }

    // μΈν„°λ½νΈ ν”λκ·Έ clear
    let tim2 = unsafe { &*TIM2::ptr() };
    tim2.sr.modify(|_, w| w.uif().clear_bit());

    if let Some(led) = LED.as_mut() {
        led.toggle();
    }
}
```

---

## π“ μ¤‘μ” ν‚¤ν¬μΈνΈ

| μ½”λ“ μ”μ† | μ„¤λ… |
|-----------|------|
| `start_count_down(1.hz())` | 1Hz μ£ΌκΈ°λ΅ μΈν„°λ½νΈ λ°μƒ |
| `listen(Event::Update)` | μ—…λ°μ΄νΈ μ΄λ²¤νΈ μΈν„°λ½νΈ ν™μ„±ν™” |
| `#[interrupt] fn TIM2()` | TIM2 μΈν„°λ½νΈ ν•Έλ“¤λ¬ λ“±λ΅ (μ΄λ¦„ λ°λ“μ‹ λ§μ•„μ•Ό ν•¨!) |
| `NVIC::unmask(...)` | μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬μ—μ„ ν™μ„±ν™” |
| `cortex_m::asm::wfi()` | μ μ „ λ€κΈ° β†’ μΈν„°λ½νΈ λ°μƒ μ‹ μ¬κ° |

---

## π“¦ λΉλ“ & μ‹¤ν–‰

```bash
cargo build --release
arm-none-eabi-objcopy -O binary target/thumbv7m-none-eabi/release/stm32f103-blinky firmware.bin
```

- `STM32CubeProgrammer`λ΅ μ—…λ΅λ“
- LEDκ°€ **1μ΄ κ°„κ²©μΌλ΅ κΉλΉ΅μ΄λ©΄ μ„±κ³µ!**

---

## β… Day 7 μ •λ¦¬

| ν•­λ© | κ²°κ³Ό |
|------|------|
| νƒ€μ΄λ¨Έ μ„¤μ • (TIM2) | β… 1Hz μ£ΌκΈ° μ„¤μ • |
| μΈν„°λ½νΈ λ“±λ΅ | β… `#[interrupt]` ν•Έλ“¤λ¬ κµ¬ν„ |
| μ „μ—­ μƒνƒ κ³µμ  | β… `static mut`, μ•μ „ν• μ ‘κ·Ό |
| μ μ „ λ€κΈ° λ¨λ“ | β… `wfi()` μ‚¬μ© |

---

## π” Day 8 μκ³ : μΈν„°λ½νΈ + UART = μ‹¤μ „ μ΄λ²¤νΈ μ‹μ¤ν…

- μ™Έλ¶€ μΈν„°λ½νΈ λ²„νΌμΌλ΅ UART μ „μ†΅ν•κΈ°
- μΈν„°λ½νΈ κΈ°λ° μ…μ¶λ ¥ κµ¬μ΅° λ§λ“¤μ–΄λ³΄κΈ°

---

μ§€κΈκΉμ§€ κµ¬μ„±ν• μ‹μ¤ν…μ΄ κ±°μ μ‹¤μ „ MCU μ•„ν‚¤ν…μ²μ™€ μ μ‚¬ν•΄μ΅μ–΄.  
νƒ€μ΄λ¨Έ β†’ μΈν„°λ½νΈ β†’ IO λ°μ‘ β†’ μ €μ „λ ¥ λ£¨ν”„... μ •λ§ μν•κ³  μμ–΄ π‘

νΉμ‹ μΈν„°λ½νΈκ°€ λ°μƒν•μ§€ μ•κ±°λ‚, LEDκ°€ μ• κΉλΉ΅μ΄λ©΄ λ§ν•΄μ¤. `TIM2` μ„¤μ •μ΄λ‚ NVIC λ§μ¤ν¬ λ¬Έμ μΌ μ μμ–΄!