---
title: "Day 1~3 - Rust ì„ë² ë””ë“œ ê°œë°œ í™˜ê²½ ì„¤ì¹˜ë¶€í„° ì²« ë¹Œë“œê¹Œì§€"
date: 2025-04-05
categories: [rust_project]
tags: [Rust, Embedded, STM32, ì„¤ì¹˜, Cargo, HAL, rust_project]
description: "Rustë¡œ STM32 ì„ë² ë””ë“œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•œ í™˜ê²½ êµ¬ì„±, íˆ´ì²´ì¸ ì„¤ì¹˜, í”„ë¡œì íŠ¸ ì„¸íŒ… ë° ì²« ë¹Œë“œê¹Œì§€ì˜ ì—¬ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤."
---

ë“œë””ì–´ Rustë¡œ STM32 ì„ë² ë””ë“œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆë‹¤.  
Cë¡œëŠ” ìˆ˜ë„ ì—†ì´ í•´ë´¤ì§€ë§Œ, RustëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ìƒíƒœê³„ì˜€ë‹¤. ê·¸ ì‹œì‘ì€ ì„¤ì¹˜ì™€ ë¹Œë“œ í™˜ê²½ êµ¬ì„±ë¶€í„°ì˜€ë‹¤.

---

## 1. Rust ì„ë² ë””ë“œ ìƒíƒœê³„ êµ¬ì¡°

Rustì—ì„œ ì„ë² ë””ë“œë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ ìƒíƒœê³„ëŠ” ëŒ€ëµ ë‹¤ìŒ 4ê°€ì§€ ì¸µìœ¼ë¡œ êµ¬ì„±ëœë‹¤:

### ğŸ”§ 1. Core Crates
- `core`, `cortex-m`, `cortex-m-rt` ë“± ê¸°ë³¸ì ì¸ no_std í™˜ê²½ ì§€ì›
- `panic-halt`, `panic-probe` ë“± panic ì²˜ë¦¬ìš©

### âš™ï¸ 2. HAL (Hardware Abstraction Layer)
- `stm32f1xx-hal`, `stm32l0xx-hal` ë“± ì‹œë¦¬ì¦ˆë³„ë¡œ ì¡´ì¬
- GPIO, íƒ€ì´ë¨¸, SPI, UART ë“±ì„ ì•ˆì „í•˜ê²Œ ì¶”ìƒí™”

### ğŸ§  3. RTOS-like í”„ë ˆì„ì›Œí¬
- ì˜ˆ: `RTIC`, `Embassy` ë“±. ë¹„ë™ê¸° ì§€ì› ë° ì¸í„°ëŸ½íŠ¸ ê¸°ë°˜ êµ¬ì¡°ì— ìœ ìš©

### ğŸ”¨ 4. ë¹Œë“œ ë„êµ¬
- `cargo` ê¸°ë°˜
- `.cargo/config.toml`, `memory.x`, `build.rs` ë“±ìœ¼ë¡œ í”Œë«í¼ ë§ì¶¤í™”

---

## 2. ê°œë°œ í™˜ê²½ ì„¤ì¹˜

### âœ… Rust ì„¤ì¹˜ í™•ì¸

```shell
rustup --version
cargo --version
```

### ğŸ’» ì„¤ì¹˜ ë°©ë²•

- Windows: [https://rustup.rs](https://rustup.rs) ì—ì„œ `rustup-init.exe` ì‹¤í–‰
- Linux:  
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ ì˜ ì•ˆ ë˜ì–´ ìˆì„ ê²½ìš°:
- `C:\Users\username\.cargo\bin`ì´ PATHì— ìˆëŠ”ì§€ í™•ì¸
- VS Codeë¥¼ ê»ë‹¤ ì¼œì•¼ ë°˜ì˜ë˜ëŠ” ê²½ìš°ë„ ìˆìŒ

---

## 3. íƒ€ê²Ÿ ì„¤ì •ê³¼ íˆ´ì²´ì¸ ì„¤ì¹˜

ì²˜ìŒì—” STM32L100 ì¹©(Cortex-M0+)ì„ ì“°ë ¤ í–ˆê¸° ë•Œë¬¸ì—:

```bash
rustup target add thumbv6m-none-eabi
```

í•˜ì§€ë§Œ ì´í›„ Cortex-M3 ê³„ì—´ì˜ STM32F103ìœ¼ë¡œ ë°”ê¾¸ë©´ì„œ:

```bash
rustup target add thumbv7m-none-eabi
```

ê·¸ë¦¬ê³  C ë¹Œë“œë¥¼ ìœ„í•´ ARM íˆ´ì²´ì¸ì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤:

- [GNU Arm Embedded Toolchain](https://developer.arm.com/downloads/-/gnu-rm)
- ì˜ˆ: `C:\Program Files (x86)\GNU Arm Embedded Toolchain\10 2021.10\bin`

---

## 4. VS Code í™•ì¥ ì„¤ì¹˜

| í™•ì¥ ì´ë¦„         | ì„¤ëª… |
|------------------|------|
| rust-analyzer     | ìë™ì™„ì„±, ì¸í…”ë¦¬ì„¼ìŠ¤ |
| Even Better TOML  | `Cargo.toml` ë¬¸ë²• ê°•ì¡° |
| Dependi (crates)  | íŒ¨í‚¤ì§€ ë²„ì „ ë³´ê¸° |
| Cortex-Debug      | ë””ë²„ê¹… (ST-Link, OpenOCD) ì§€ì› |

---

## 5. Cargo í”„ë¡œì íŠ¸ ìƒì„±

```bash
cargo new stm32f103-blinky
cd stm32f103-blinky
```

`.cargo/config.toml` ì„ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±:

```toml
[build]
target = "thumbv7m-none-eabi"

[unstable]
build-std = ["core"]

rustflags = ["-C", "link-arg=-Tlink.x"]
```

> âœ… `link-arg=-Tlink.x`ë¥¼ ì•ˆ ë„£ìœ¼ë©´ ë¹Œë“œëœ `.bin` íŒŒì¼ í¬ê¸°ê°€ 0ì´ ë˜ëŠ” ë¬¸ì œê°€ ìƒê¹€!

---

## 6. ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ ì„¤ì • (memory.x)

```ld
MEMORY
{
  FLASH : ORIGIN = 0x08000000, LENGTH = 256K
  RAM   : ORIGIN = 0x20000000, LENGTH = 16K
}
```

ì¹© ì‚¬ì–‘ì„œì—ì„œ Flashì™€ RAM ìš©ëŸ‰ì„ ì°¾ì•„ ì •í™•íˆ ì‘ì„±í•´ì•¼ í•œë‹¤.  
(Cortex-M0+ì¸ ì¤„ ì•Œì•˜ëŠ”ë° ì•Œê³  ë³´ë‹ˆ M3 â†’ ì‚¬ì–‘ ë³€ê²½)

---

## 7. `Cargo.toml` ì„¤ì •

```toml
[dependencies]
cortex-m = "0.7"
cortex-m-rt = "0.7"
panic-halt = "1.0.0"

[dependencies.stm32f1xx-hal]
version = "0.10"
features = ["stm32f103", "rt", "medium"]

[build-dependencies]
cc = "1.2.18"
```

---

## 8. ì²« ë¹Œë“œ & Blink ì˜ˆì œ

```rust
#[entry]
fn main() -> ! {
    let dp = pac::Peripherals::take().unwrap();
    let cp = cortex_m::Peripherals::take().unwrap();

    let mut flash = dp.FLASH.constrain();
    let mut rcc = dp.RCC.constrain();

    let clocks = rcc.cfgr
        .use_hse(8.MHz())
        .sysclk(72.MHz())
        .pclk1(36.MHz())
        .freeze(&mut flash.acr);

    let mut gpioc = dp.GPIOC.split();
    let mut led = gpioc.pc13.into_push_pull_output(&mut gpioc.crh);

    let mut delay = Timer::syst(cp.SYST, &clocks).delay();

    loop {
        led.set_low();
        delay.delay_ms(500u16);

        led.set_high();
        delay.delay_ms(500u16);
    }
}
```

---

## 9. ë¹Œë“œ & ì‚¬ì´ì¦ˆ í™•ì¸ ëª…ë ¹ì–´

```bash
cargo build --release
arm-none-eabi-size target/thumbv7m-none-eabi/release/stm32f103-blinky
arm-none-eabi-objcopy -O binary target/thumbv7m-none-eabi/release/stm32f103-blinky firmware.bin
```

---

## ğŸ” ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| `rustup target add` | Cortex-M ì•„í‚¤í…ì²˜ì— ë§ëŠ” íƒ€ê²Ÿ ì„¤ì • |
| `.cargo/config.toml` | ë¹Œë“œ íƒ€ê²Ÿ, ë§ì»¤ ì„¤ì •, í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œì™¸ |
| `memory.x` | Flash/RAM ë ˆì´ì•„ì›ƒ ì§€ì • |
| `link-arg=-Tlink.x` | bin ì‚¬ì´ì¦ˆ 0 ì˜¤ë¥˜ ë°©ì§€ |
| `stm32f1xx-hal` | STM32F103 ì „ìš© HAL ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| `cargo build`, `objcopy` | ë¹Œë“œ ë° ë°”ì´ë„ˆë¦¬ ìƒì„± |

---

## ëŠë‚€ ì 

ì²˜ìŒì—” "ê·¸ëƒ¥ ì„¤ì¹˜í•˜ê³  ì½”ë“œ ì“°ë©´ ë˜ê² ì§€?" í–ˆì§€ë§Œ,  
RustëŠ” ì‹œì‘ë¶€í„° ì‹œìŠ¤í…œì˜ ëª¨ë“  ê±¸ ëª…ì‹œì ìœ¼ë¡œ **ì„ ì–¸í•˜ê³  êµ¬ì„±**í•´ì•¼ í•œë‹¤.  
ì´ê±´ ë²ˆê±°ë¡­ì§€ë§Œ, ê·¸ë§Œí¼ **ë‚´ê°€ ë§Œë“œëŠ” ì‹œìŠ¤í…œì„ ì •í™•íˆ ì´í•´í•˜ê³  í†µì œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê³¼ì •**ì´ì—ˆë‹¤.

ì´ì œëŠ” Cë¡œ ê°œë°œí•  ë•Œë³´ë‹¤ ë” ì•ˆì „í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë°©ì‹ìœ¼ë¡œ, STM32 ê°œë°œì„ í•  ìˆ˜ ìˆì„ ê±°ë€ í™•ì‹ ì´ ìƒê¸´ë‹¤.